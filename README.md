ARM Linux bootable disks
========================

This is a generic set of scripts that I use to deploy various root
filesystems to my ARMv7 and ARMv8 based boards (Layerscape, Marvell
etc).

There are two scripts.

backup-rootfs.sh
----------------

This takes a rootfs folder tree and packs it inside a gzipped tar
archive. The input folder (passed via the --mount-point argument) can be
a dump of an existing rootfs, a rootfs minimally set up using
debootstrap, a rootfs downloaded from https://archlinuxarm.org/, etc.

Example for Debian Bullseye on armv7:

```
sudo apt install debootstrap qemu-user-static
OUT="debian-bullseye-armhf"
sudo debootstrap --arch armhf --foreign bullseye $OUT
sudo cp "$(which qemu-arm-static)" "${OUT}/usr/bin"
sudo chroot "$OUT" /debootstrap/debootstrap --second-stage
sudo chroot "$OUT" passwd
sudo ./backup-rootfs.sh --mount-point $OUT --rootfs debian-bullseye-armv7.tar.gz
sudo rm -rf $OUT
```

mkbootabledisk.sh
-----------------

This takes an input rootfs packed as a gzipped tar archive, plus a
kernel and dtb provided by the user, and creates an image with two
partitions.

- First partition is the "vendor" partition, this is an EFI system
  partition which contains the board-specific stuff: the kernel, the
  dtb, and the means for the bootloader to find what's inside. With
  U-Boot's distro boot system, this means either an extlinux.conf file
  which is auto-generated by this tool, or a user provided U-Boot
  command file.

- Second partition is the "rootfs" partition. This contains an unaltered
  copy of the extracted tarball provided by the user.

Example for Debian Bullseye on armv7:

```
./mkbootabledisk.sh \
	--rootfs debian-bullseye-armv7.tar.gz \
	--label "Debian Bullseye" \
	--dtb /opt/arm-linux/arch/arm/boot/dts/ls1021a-tsn.dtb \
	--kernel /opt/arm-linux/arch/arm/boot/uImage \
	--vendor-script vendor/ls1021a/ls1021atsn_vendor.sh \
	--out /dev/sdN
```
